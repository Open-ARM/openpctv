#!/bin/sh

/usr/bin/videocache
PLUGINS=""
. /etc/system.options
if [ $CAM = "OScam" ]; then
  sed -i 's/^ENABLED=.*/ENABLED=no/g' /etc/vdr/plugins.d/10_sc
  sed -i 's/^ENABLED=.*/ENABLED=yes/g' /etc/vdr/plugins.d/50_dvbapi
elif [ $CAM = "VDR-SC" ]; then
  sed -i 's/^ENABLED=.*/ENABLED=yes/g' /etc/vdr/plugins.d/10_sc
  sed -i 's/^ENABLED=.*/ENABLED=no/g' /etc/vdr/plugins.d/50_dvbapi
  /usr/bin/getcam auto
  systemctl stop oscam
fi
sync
sleep 0.1
for file in /etc/vdr/plugins.d/*; do
  if [ -f "$file" ]; then
    # plugins are enabled by default
    PLUGIN=""
    OPTIONS=""
    INITCMD=""
    ENABLED=yes
    . $file
    [ "$ENABLED" = yes ] && PLUGINS="$PLUGINS -P'$PLUGIN $OPTIONS'"
    [ -n "$INITCMD" ] && eval $INITCMD
  fi
done
[ -r /etc/locale.conf ] && export LANG=`cat /etc/locale.conf | cut -d= -f2`
export LC_ALL=$LANG
export DISPLAY=":0.0"

# special for germany :
[ "$LANG" = de_DE.UTF-8 ] && export VDR_CHARSET_OVERRIDE=”ISO-8859-15″
chvt 4
eval vdr -g /tmp --vfat $PLUGINS -v /video -c /etc/vdr -p 2001 --lirc -s shutdown
